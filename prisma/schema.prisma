generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model daily_reports {
  id                 String    @id @default(dbgenerated("(uuid())")) @db.Char(36)
  merchant_id        String    @db.Char(36)
  report_date        DateTime  @db.Date
  total_sales        Decimal   @db.Decimal(14, 2)
  total_transactions Int
  created_at         DateTime  @default(now()) @db.Timestamp(0)
  updated_at         DateTime  @default(now()) @db.Timestamp(0)
  created_by         String?   @db.Char(36)
  updated_by         String?   @db.Char(36)
  merchants          merchants @relation(fields: [merchant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "daily_reports_ibfk_1")

  @@unique([merchant_id, report_date], map: "unique_merchant_date")
  @@index([merchant_id], map: "idx_daily_reports_merchant")
}

model merchants {
  id            String          @id @default(dbgenerated("(uuid())")) @db.Char(36)
  slug          String          @unique(map: "slug") @db.VarChar(120)
  name          String          @db.VarChar(150)
  phone         String?         @db.VarChar(50)
  address       String?         @db.Text
  logo          String?         @db.Text
  created_at    DateTime        @default(now()) @db.Timestamp(0)
  updated_at    DateTime        @default(now()) @db.Timestamp(0)
  created_by    String?         @db.Char(36)
  updated_by    String?         @db.Char(36)
  daily_reports daily_reports[]
  outlets       outlets[]
  products      products[]
  users         users[]
}

model outlets {
  id           String         @id @default(dbgenerated("(uuid())")) @db.Char(36)
  merchant_id  String         @db.Char(36)
  slug         String         @db.VarChar(120)
  name         String         @db.VarChar(150)
  location     String?        @db.Text
  logo         String?        @db.Text
  is_active    Boolean        @default(true)
  created_at   DateTime       @default(now()) @db.Timestamp(0)
  updated_at   DateTime       @default(now()) @db.Timestamp(0)
  created_by   String?        @db.Char(36)
  updated_by   String?        @db.Char(36)
  merchants    merchants      @relation(fields: [merchant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "outlets_ibfk_1")
  shifts       shifts[]
  transactions transactions[]
  user_roles   user_roles[]

  @@unique([merchant_id, slug], map: "unique_merchant_slug")
  @@index([merchant_id], map: "idx_outlets_merchant")
}

model permissions {
  id               String             @id @default(dbgenerated("(uuid())")) @db.Char(36)
  code             String             @unique(map: "code") @db.VarChar(120)
  description      String?            @db.Text
  created_at       DateTime           @default(now()) @db.Timestamp(0)
  updated_at       DateTime           @default(now()) @db.Timestamp(0)
  created_by       String?            @db.Char(36)
  updated_by       String?            @db.Char(36)
  role_permissions role_permissions[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model products {
  id                String              @id @default(dbgenerated("(uuid())")) @db.Char(36)
  merchant_id       String              @db.Char(36)
  slug              String              @db.VarChar(120)
  thumbnail         String?             @db.Text
  name              String              @db.VarChar(150)
  category          String?             @db.VarChar(120)
  price             Decimal             @db.Decimal(14, 2)
  cost              Decimal             @default(0.00) @db.Decimal(14, 2)
  stock_qty         Int                 @default(0)
  min_stock         Int                 @default(0)
  is_active         Boolean             @default(true)
  created_at        DateTime            @default(now()) @db.Timestamp(0)
  updated_at        DateTime            @default(now()) @db.Timestamp(0)
  created_by        String?             @db.Char(36)
  updated_by        String?             @db.Char(36)
  merchants         merchants           @relation(fields: [merchant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "products_ibfk_1")
  stock_logs        stock_logs[]
  transaction_items transaction_items[]

  @@unique([merchant_id, slug], map: "unique_merchant_slug")
  @@index([is_active], map: "idx_products_active")
  @@index([merchant_id], map: "idx_products_merchant")
}

model role_permissions {
  role_id       String      @db.Char(36)
  permission_id String      @db.Char(36)
  created_at    DateTime    @default(now()) @db.Timestamp(0)
  updated_at    DateTime    @default(now()) @db.Timestamp(0)
  created_by    String?     @db.Char(36)
  updated_by    String?     @db.Char(36)
  roles         roles       @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "role_permissions_ibfk_1")
  permissions   permissions @relation(fields: [permission_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "role_permissions_ibfk_2")

  @@id([role_id, permission_id])
  @@index([permission_id], map: "permission_id")
}

model roles {
  id               String             @id @default(dbgenerated("(uuid())")) @db.Char(36)
  name             String             @unique(map: "name") @db.VarChar(100)
  description      String?            @db.Text
  created_at       DateTime           @default(now()) @db.Timestamp(0)
  updated_at       DateTime           @default(now()) @db.Timestamp(0)
  role_permissions role_permissions[]
  user_roles       user_roles[]
}

model shifts {
  id           String         @id @default(dbgenerated("(uuid())")) @db.Char(36)
  outlet_id    String         @db.Char(36)
  user_id      String         @db.Char(36)
  start_time   DateTime       @db.Timestamp(0)
  end_time     DateTime?      @db.Timestamp(0)
  status       String         @db.VarChar(50)
  created_at   DateTime       @default(now()) @db.Timestamp(0)
  updated_at   DateTime       @default(now()) @db.Timestamp(0)
  created_by   String?        @db.Char(36)
  updated_by   String?        @db.Char(36)
  outlets      outlets        @relation(fields: [outlet_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "shifts_ibfk_1")
  users        users          @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "shifts_ibfk_2")
  transactions transactions[]

  @@index([outlet_id], map: "idx_shifts_outlet")
  @@index([user_id], map: "idx_shifts_user")
}

model stock_logs {
  id         String   @id @default(dbgenerated("(uuid())")) @db.Char(36)
  product_id String   @db.Char(36)
  change_qty Int
  reason     String   @db.VarChar(50)
  ref_id     String?  @db.Char(36)
  created_at DateTime @default(now()) @db.Timestamp(0)
  updated_at DateTime @default(now()) @db.Timestamp(0)
  created_by String?  @db.Char(36)
  updated_by String?  @db.Char(36)
  products   products @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "stock_logs_ibfk_1")

  @@index([product_id], map: "idx_stock_logs_product")
  @@index([ref_id], map: "idx_stock_logs_ref")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model transaction_items {
  id                    String       @id @default(dbgenerated("(uuid())")) @db.Char(36)
  transaction_id        String       @db.Char(36)
  product_id            String?      @db.Char(36)
  product_name_snapshot String       @db.VarChar(150)
  price_snapshot        Decimal      @db.Decimal(14, 2)
  qty                   Int
  subtotal              Decimal      @db.Decimal(14, 2)
  created_at            DateTime     @default(now()) @db.Timestamp(0)
  updated_at            DateTime     @default(now()) @db.Timestamp(0)
  created_by            String?      @db.Char(36)
  updated_by            String?      @db.Char(36)
  transactions          transactions @relation(fields: [transaction_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "transaction_items_ibfk_1")
  products              products?    @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "transaction_items_ibfk_2")

  @@index([product_id], map: "idx_tx_items_product")
  @@index([transaction_id], map: "idx_tx_items_tx")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model transactions {
  id                String              @id @default(dbgenerated("(uuid())")) @db.Char(36)
  outlet_id         String              @db.Char(36)
  user_id           String              @db.Char(36)
  shift_id          String?             @db.Char(36)
  payment_method    String              @db.VarChar(50)
  total_amount      Decimal             @db.Decimal(14, 2)
  is_offline        Boolean             @default(false)
  device_id         String?             @db.VarChar(120)
  created_at        DateTime            @default(now()) @db.Timestamp(0)
  updated_at        DateTime            @default(now()) @db.Timestamp(0)
  created_by        String?             @db.Char(36)
  updated_by        String?             @db.Char(36)
  transaction_items transaction_items[]
  outlets           outlets             @relation(fields: [outlet_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "transactions_ibfk_1")
  users             users               @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "transactions_ibfk_2")
  shifts            shifts?             @relation(fields: [shift_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "transactions_ibfk_3")

  @@index([created_at], map: "idx_tx_created")
  @@index([outlet_id], map: "idx_tx_outlet")
  @@index([shift_id], map: "idx_tx_shift")
  @@index([user_id], map: "idx_tx_user")
}

model user_roles {
  user_id    String   @db.Char(36)
  role_id    String   @db.Char(36)
  outlet_id  String   @db.Char(36)
  created_at DateTime @default(now()) @db.Timestamp(0)
  updated_at DateTime @default(now()) @db.Timestamp(0)
  created_by String?  @db.Char(36)
  updated_by String?  @db.Char(36)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_roles_ibfk_1")
  roles      roles    @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_roles_ibfk_2")
  outlets    outlets  @relation(fields: [outlet_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_roles_ibfk_3")

  @@id([user_id, role_id, outlet_id])
  @@index([outlet_id], map: "idx_user_roles_outlet")
  @@index([user_id], map: "idx_user_roles_user")
  @@index([role_id], map: "role_id")
}

model users {
  id            String         @id @default(dbgenerated("(uuid())")) @db.Char(36)
  merchant_id   String         @db.Char(36)
  avatar        String?        @db.Text
  username      String         @db.VarChar(120)
  name          String         @db.VarChar(150)
  email         String         @db.VarChar(150)
  password_hash String         @db.Text
  is_active     Boolean        @default(true)
  created_at    DateTime       @default(now()) @db.Timestamp(0)
  updated_at    DateTime       @default(now()) @db.Timestamp(0)
  created_by    String?        @db.Char(36)
  updated_by    String?        @db.Char(36)
  shifts        shifts[]
  transactions  transactions[]
  user_roles    user_roles[]
  merchants     merchants      @relation(fields: [merchant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "users_ibfk_1")

  @@unique([merchant_id, email], map: "unique_merchant_email")
  @@unique([merchant_id, username], map: "unique_merchant_username")
  @@index([merchant_id], map: "idx_users_merchant")
}
